import e from"buffer";var t={};var r=t&&t.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(t,"__esModule",{value:true});t.DetailContext=t.NoopContext=t.VError=void 0;var n=function(e){r(VError,e);function VError(t,r){var n=e.call(this,r)||this;n.path=t;Object.setPrototypeOf(n,VError.prototype);return n}return VError}(Error);t.VError=n;var o=function(){function NoopContext(){}NoopContext.prototype.fail=function(e,t,r){return false};NoopContext.prototype.unionResolver=function(){return this};NoopContext.prototype.createContext=function(){return this};NoopContext.prototype.resolveUnion=function(e){};return NoopContext}();t.NoopContext=o;var i=function(){function DetailContext(){this._propNames=[""];this._messages=[null];this._score=0}DetailContext.prototype.fail=function(e,t,r){this._propNames.push(e);this._messages.push(t);this._score+=r;return false};DetailContext.prototype.unionResolver=function(){return new a};DetailContext.prototype.resolveUnion=function(e){var t,r;var n=e;var o=null;for(var i=0,a=n.contexts;i<a.length;i++){var u=a[i];(!o||u._score>=o._score)&&(o=u)}if(o&&o._score>0){(t=this._propNames).push.apply(t,o._propNames);(r=this._messages).push.apply(r,o._messages)}};DetailContext.prototype.getError=function(e){var t=[];for(var r=this._propNames.length-1;r>=0;r--){var o=this._propNames[r];e+="number"===typeof o?"["+o+"]":o?"."+o:"";var i=this._messages[r];i&&t.push(e+" "+i)}return new n(e,t.join("; "))};DetailContext.prototype.getErrorDetail=function(e){var t=[];for(var r=this._propNames.length-1;r>=0;r--){var n=this._propNames[r];e+="number"===typeof n?"["+n+"]":n?"."+n:"";var o=this._messages[r];o&&t.push({path:e,message:o})}var i=null;for(var r=t.length-1;r>=0;r--){i&&(t[r].nested=[i]);i=t[r]}return i};return DetailContext}();t.DetailContext=i;var a=function(){function DetailUnionResolver(){this.contexts=[]}DetailUnionResolver.prototype.createContext=function(){var e=new i;this.contexts.push(e);return e};return DetailUnionResolver}();var u={};var c=e.Buffer;var s=u&&u.__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return extendStatics(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();Object.defineProperty(u,"__esModule",{value:true});u.basicTypes=u.BasicType=u.TParamList=u.TParam=u.param=u.TFunc=u.func=u.TProp=u.TOptional=u.opt=u.TIface=u.iface=u.TEnumLiteral=u.enumlit=u.TEnumType=u.enumtype=u.TIntersection=u.intersection=u.TUnion=u.union=u.TTuple=u.tuple=u.TArray=u.array=u.TLiteral=u.lit=u.TName=u.name=u.TType=void 0;var p=t;var f=function(){function TType(){}return TType}();u.TType=f;function parseSpec(e){return"string"===typeof e?name(e):e}function getNamedType(e,t){var r=e[t];if(!r)throw new Error("Unknown type "+t);return r}function name(e){return new l(e)}u.name=name;var l=function(e){s(TName,e);function TName(t){var r=e.call(this)||this;r.name=t;r._failMsg="is not a "+t;return r}TName.prototype.getChecker=function(e,t,r){var n=this;var o=getNamedType(e,this.name);var i=o.getChecker(e,t,r);return o instanceof O||o instanceof TName?i:function(e,t){return!!i(e,t)||t.fail(null,n._failMsg,0)}};return TName}(f);u.TName=l;function lit(e){return new h(e)}u.lit=lit;var h=function(e){s(TLiteral,e);function TLiteral(t){var r=e.call(this)||this;r.value=t;r.name=JSON.stringify(t);r._failMsg="is not "+r.name;return r}TLiteral.prototype.getChecker=function(e,t){var r=this;return function(e,t){return e===r.value||t.fail(null,r._failMsg,-1)}};return TLiteral}(f);u.TLiteral=h;function array(e){return new y(parseSpec(e))}u.array=array;var y=function(e){s(TArray,e);function TArray(t){var r=e.call(this)||this;r.ttype=t;return r}TArray.prototype.getChecker=function(e,t){var r=this.ttype.getChecker(e,t);return function(e,t){if(!Array.isArray(e))return t.fail(null,"is not an array",0);for(var n=0;n<e.length;n++){var o=r(e[n],t);if(!o)return t.fail(n,null,1)}return true}};return TArray}(f);u.TArray=y;function tuple(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return new m(e.map((function(e){return parseSpec(e)})))}u.tuple=tuple;var m=function(e){s(TTuple,e);function TTuple(t){var r=e.call(this)||this;r.ttypes=t;return r}TTuple.prototype.getChecker=function(e,t){var r=this.ttypes.map((function(r){return r.getChecker(e,t)}));var checker=function(e,t){if(!Array.isArray(e))return t.fail(null,"is not an array",0);for(var n=0;n<r.length;n++){var o=r[n](e[n],t);if(!o)return t.fail(n,null,1)}return true};return t?function(e,t){return!!checker(e,t)&&(e.length<=r.length||t.fail(r.length,"is extraneous",2))}:checker};return TTuple}(f);u.TTuple=m;function union(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return new T(e.map((function(e){return parseSpec(e)})))}u.union=union;var T=function(e){s(TUnion,e);function TUnion(t){var r=e.call(this)||this;r.ttypes=t;var n=t.map((function(e){return e instanceof l||e instanceof h?e.name:null})).filter((function(e){return e}));var o=t.length-n.length;if(n.length){o>0&&n.push(o+" more");r._failMsg="is none of "+n.join(", ")}else r._failMsg="is none of "+o+" types";return r}TUnion.prototype.getChecker=function(e,t){var r=this;var n=this.ttypes.map((function(r){return r.getChecker(e,t)}));return function(e,t){var o=t.unionResolver();for(var i=0;i<n.length;i++){var a=n[i](e,o.createContext());if(a)return true}t.resolveUnion(o);return t.fail(null,r._failMsg,0)}};return TUnion}(f);u.TUnion=T;function intersection(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];return new v(e.map((function(e){return parseSpec(e)})))}u.intersection=intersection;var v=function(e){s(TIntersection,e);function TIntersection(t){var r=e.call(this)||this;r.ttypes=t;return r}TIntersection.prototype.getChecker=function(e,t){var r=new Set;var n=this.ttypes.map((function(n){return n.getChecker(e,t,r)}));return function(e,t){var r=n.every((function(r){return r(e,t)}));return!!r||t.fail(null,null,0)}};return TIntersection}(f);u.TIntersection=v;function enumtype(e){return new g(e)}u.enumtype=enumtype;var g=function(e){s(TEnumType,e);function TEnumType(t){var r=e.call(this)||this;r.members=t;r.validValues=new Set;r._failMsg="is not a valid enum value";r.validValues=new Set(Object.keys(t).map((function(e){return t[e]})));return r}TEnumType.prototype.getChecker=function(e,t){var r=this;return function(e,t){return!!r.validValues.has(e)||t.fail(null,r._failMsg,0)}};return TEnumType}(f);u.TEnumType=g;function enumlit(e,t){return new b(e,t)}u.enumlit=enumlit;var b=function(e){s(TEnumLiteral,e);function TEnumLiteral(t,r){var n=e.call(this)||this;n.enumName=t;n.prop=r;n._failMsg="is not "+t+"."+r;return n}TEnumLiteral.prototype.getChecker=function(e,t){var r=this;var n=getNamedType(e,this.enumName);if(!(n instanceof g))throw new Error("Type "+this.enumName+" used in enumlit is not an enum type");var o=n.members[this.prop];if(!n.members.hasOwnProperty(this.prop))throw new Error("Unknown value "+this.enumName+"."+this.prop+" used in enumlit");return function(e,t){return e===o||t.fail(null,r._failMsg,-1)}};return TEnumLiteral}(f);u.TEnumLiteral=b;function makeIfaceProps(e){return Object.keys(e).map((function(t){return makeIfaceProp(t,e[t])}))}function makeIfaceProp(e,t){return t instanceof C?new _(e,t.ttype,true):new _(e,parseSpec(t),false)}function iface(e,t){return new d(e,makeIfaceProps(t))}u.iface=iface;var d=function(e){s(TIface,e);function TIface(t,r){var n=e.call(this)||this;n.bases=t;n.props=r;n.propSet=new Set(r.map((function(e){return e.name})));return n}TIface.prototype.getChecker=function(e,t,r){var n=this;var o=this.bases.map((function(r){return getNamedType(e,r).getChecker(e,t)}));var i=this.props.map((function(r){return r.ttype.getChecker(e,t)}));var a=new p.NoopContext;var u=this.props.map((function(e,t){return!e.isOpt&&!i[t](void 0,a)}));var checker=function(e,t){if("object"!==typeof e||null===e)return t.fail(null,"is not an object",0);for(var r=0;r<o.length;r++)if(!o[r](e,t))return false;for(var r=0;r<i.length;r++){var a=n.props[r].name;var c=e[a];if(void 0===c){if(u[r])return t.fail(a,"is missing",1)}else{var s=i[r](c,t);if(!s)return t.fail(a,null,1)}}return true};if(!t)return checker;var c=this.propSet;if(r){this.propSet.forEach((function(e){return r.add(e)}));c=r}return function(e,t){if(!checker(e,t))return false;for(var r in e)if(!c.has(r))return t.fail(r,"is extraneous",2);return true}};return TIface}(f);u.TIface=d;function opt(e){return new C(parseSpec(e))}u.opt=opt;var C=function(e){s(TOptional,e);function TOptional(t){var r=e.call(this)||this;r.ttype=t;return r}TOptional.prototype.getChecker=function(e,t){var r=this.ttype.getChecker(e,t);return function(e,t){return void 0===e||r(e,t)}};return TOptional}(f);u.TOptional=C;var _=function(){function TProp(e,t,r){this.name=e;this.ttype=t;this.isOpt=r}return TProp}();u.TProp=_;function func(e){var t=[];for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];return new k(new P(t),parseSpec(e))}u.func=func;var k=function(e){s(TFunc,e);function TFunc(t,r){var n=e.call(this)||this;n.paramList=t;n.result=r;return n}TFunc.prototype.getChecker=function(e,t){return function(e,t){return"function"===typeof e||t.fail(null,"is not a function",0)}};return TFunc}(f);u.TFunc=k;function param(e,t,r){return new w(e,parseSpec(t),Boolean(r))}u.param=param;var w=function(){function TParam(e,t,r){this.name=e;this.ttype=t;this.isOpt=r}return TParam}();u.TParam=w;var P=function(e){s(TParamList,e);function TParamList(t){var r=e.call(this)||this;r.params=t;return r}TParamList.prototype.getChecker=function(e,t){var r=this;var n=this.params.map((function(r){return r.ttype.getChecker(e,t)}));var o=new p.NoopContext;var i=this.params.map((function(e,t){return!e.isOpt&&!n[t](void 0,o)}));var checker=function(e,t){if(!Array.isArray(e))return t.fail(null,"is not an array",0);for(var o=0;o<n.length;o++){var a=r.params[o];if(void 0===e[o]){if(i[o])return t.fail(a.name,"is missing",1)}else{var u=n[o](e[o],t);if(!u)return t.fail(a.name,null,1)}}return true};return t?function(e,t){return!!checker(e,t)&&(e.length<=n.length||t.fail(n.length,"is extraneous",2))}:checker};return TParamList}(f);u.TParamList=P;var O=function(e){s(BasicType,e);function BasicType(t,r){var n=e.call(this)||this;n.validator=t;n.message=r;return n}BasicType.prototype.getChecker=function(e,t){var r=this;return function(e,t){return!!r.validator(e)||t.fail(null,r.message,0)}};return BasicType}(f);u.BasicType=O;u.basicTypes={any:new O((function(e){return true}),"is invalid"),number:new O((function(e){return"number"===typeof e}),"is not a number"),object:new O((function(e){return"object"===typeof e&&e}),"is not an object"),boolean:new O((function(e){return"boolean"===typeof e}),"is not a boolean"),string:new O((function(e){return"string"===typeof e}),"is not a string"),symbol:new O((function(e){return"symbol"===typeof e}),"is not a symbol"),void:new O((function(e){return null==e}),"is not void"),undefined:new O((function(e){return void 0===e}),"is not undefined"),null:new O((function(e){return null===e}),"is not null"),never:new O((function(e){return false}),"is unexpected"),Date:new O(getIsNativeChecker("[object Date]"),"is not a Date"),RegExp:new O(getIsNativeChecker("[object RegExp]"),"is not a RegExp")};var j=Object.prototype.toString;function getIsNativeChecker(e){return function(t){return"object"===typeof t&&t&&j.call(t)===e}}"undefined"!==typeof c&&(u.basicTypes.Buffer=new O((function(e){return c.isBuffer(e)}),"is not a Buffer"));var _loop_1=function(e){u.basicTypes[e.name]=new O((function(t){return t instanceof e}),"is not a "+e.name)};for(var E=0,N=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,ArrayBuffer];E<N.length;E++){var x=N[E];_loop_1(x)}var A={};var L=A&&A.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],a=0,u=i.length;a<u;a++,o++)n[o]=i[a];return n};Object.defineProperty(A,"__esModule",{value:true});A.Checker=A.createCheckers=void 0;var I=u;var S=t;var U=u;Object.defineProperty(A,"TArray",{enumerable:true,get:function(){return U.TArray}});Object.defineProperty(A,"TEnumType",{enumerable:true,get:function(){return U.TEnumType}});Object.defineProperty(A,"TEnumLiteral",{enumerable:true,get:function(){return U.TEnumLiteral}});Object.defineProperty(A,"TFunc",{enumerable:true,get:function(){return U.TFunc}});Object.defineProperty(A,"TIface",{enumerable:true,get:function(){return U.TIface}});Object.defineProperty(A,"TLiteral",{enumerable:true,get:function(){return U.TLiteral}});Object.defineProperty(A,"TName",{enumerable:true,get:function(){return U.TName}});Object.defineProperty(A,"TOptional",{enumerable:true,get:function(){return U.TOptional}});Object.defineProperty(A,"TParam",{enumerable:true,get:function(){return U.TParam}});Object.defineProperty(A,"TParamList",{enumerable:true,get:function(){return U.TParamList}});Object.defineProperty(A,"TProp",{enumerable:true,get:function(){return U.TProp}});Object.defineProperty(A,"TTuple",{enumerable:true,get:function(){return U.TTuple}});Object.defineProperty(A,"TType",{enumerable:true,get:function(){return U.TType}});Object.defineProperty(A,"TUnion",{enumerable:true,get:function(){return U.TUnion}});Object.defineProperty(A,"TIntersection",{enumerable:true,get:function(){return U.TIntersection}});Object.defineProperty(A,"array",{enumerable:true,get:function(){return U.array}});Object.defineProperty(A,"enumlit",{enumerable:true,get:function(){return U.enumlit}});Object.defineProperty(A,"enumtype",{enumerable:true,get:function(){return U.enumtype}});Object.defineProperty(A,"func",{enumerable:true,get:function(){return U.func}});Object.defineProperty(A,"iface",{enumerable:true,get:function(){return U.iface}});Object.defineProperty(A,"lit",{enumerable:true,get:function(){return U.lit}});Object.defineProperty(A,"name",{enumerable:true,get:function(){return U.name}});Object.defineProperty(A,"opt",{enumerable:true,get:function(){return U.opt}});Object.defineProperty(A,"param",{enumerable:true,get:function(){return U.param}});Object.defineProperty(A,"tuple",{enumerable:true,get:function(){return U.tuple}});Object.defineProperty(A,"union",{enumerable:true,get:function(){return U.union}});Object.defineProperty(A,"intersection",{enumerable:true,get:function(){return U.intersection}});Object.defineProperty(A,"BasicType",{enumerable:true,get:function(){return U.BasicType}});var D=t;Object.defineProperty(A,"VError",{enumerable:true,get:function(){return D.VError}});function createCheckers(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object.assign.apply(Object,L([{},I.basicTypes],e));var n={};for(var o=0,i=e;o<i.length;o++){var a=i[o];for(var u=0,c=Object.keys(a);u<c.length;u++){var s=c[u];n[s]=new M(r,a[s])}}return n}A.createCheckers=createCheckers;var M=function(){function Checker(e,t,r){void 0===r&&(r="value");this.suite=e;this.ttype=t;this._path=r;this.props=new Map;if(t instanceof I.TIface)for(var n=0,o=t.props;n<o.length;n++){var i=o[n];this.props.set(i.name,i.ttype)}this.checkerPlain=this.ttype.getChecker(e,false);this.checkerStrict=this.ttype.getChecker(e,true)}Checker.prototype.setReportedPath=function(e){this._path=e};Checker.prototype.check=function(e){return this._doCheck(this.checkerPlain,e)};Checker.prototype.test=function(e){return this.checkerPlain(e,new S.NoopContext)};Checker.prototype.validate=function(e){return this._doValidate(this.checkerPlain,e)};Checker.prototype.strictCheck=function(e){return this._doCheck(this.checkerStrict,e)};Checker.prototype.strictTest=function(e){return this.checkerStrict(e,new S.NoopContext)};Checker.prototype.strictValidate=function(e){return this._doValidate(this.checkerStrict,e)};Checker.prototype.getProp=function(e){var t=this.props.get(e);if(!t)throw new Error("Type has no property "+e);return new Checker(this.suite,t,this._path+"."+e)};Checker.prototype.methodArgs=function(e){var t=this._getMethod(e);return new Checker(this.suite,t.paramList)};Checker.prototype.methodResult=function(e){var t=this._getMethod(e);return new Checker(this.suite,t.result)};Checker.prototype.getArgs=function(){if(!(this.ttype instanceof I.TFunc))throw new Error("getArgs() applied to non-function");return new Checker(this.suite,this.ttype.paramList)};Checker.prototype.getResult=function(){if(!(this.ttype instanceof I.TFunc))throw new Error("getResult() applied to non-function");return new Checker(this.suite,this.ttype.result)};Checker.prototype.getType=function(){return this.ttype};Checker.prototype._doCheck=function(e,t){var r=new S.NoopContext;if(!e(t,r)){var n=new S.DetailContext;e(t,n);throw n.getError(this._path)}};Checker.prototype._doValidate=function(e,t){var r=new S.NoopContext;if(e(t,r))return null;var n=new S.DetailContext;e(t,n);return n.getErrorDetail(this._path)};Checker.prototype._getMethod=function(e){var t=this.props.get(e);if(!t)throw new Error("Type has no property "+e);if(!(t instanceof I.TFunc))throw new Error("Property "+e+" is not a method");return t};return Checker}();A.Checker=M;const V=A.__esModule,B=A.TArray,F=A.TEnumType,R=A.TEnumLiteral,J=A.TFunc,q=A.TIface,z=A.TLiteral,G=A.TName,H=A.TOptional,K=A.TParam,Q=A.TParamList,W=A.TProp,X=A.TTuple,Y=A.TType,Z=A.TUnion,$=A.TIntersection,ee=A.array,te=A.enumlit,re=A.enumtype,ne=A.func,oe=A.iface,ie=A.lit,ae=A.name,ue=A.opt,ce=A.param,se=A.tuple,pe=A.union,fe=A.intersection,le=A.BasicType,he=A.VError;const ye=A.Checker,me=A.createCheckers;export default A;export{le as BasicType,ye as Checker,B as TArray,R as TEnumLiteral,F as TEnumType,J as TFunc,q as TIface,$ as TIntersection,z as TLiteral,G as TName,H as TOptional,K as TParam,Q as TParamList,W as TProp,X as TTuple,Y as TType,Z as TUnion,he as VError,V as __esModule,ee as array,me as createCheckers,te as enumlit,re as enumtype,ne as func,oe as iface,fe as intersection,ie as lit,ae as name,ue as opt,ce as param,se as tuple,pe as union};

